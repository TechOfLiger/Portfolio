import React, { useState, useEffect } from "react";
import { motion } from "framer-motion";

// FitnessGuide.jsx
// Single-file React component (TailwindCSS + Framer Motion)
// - Put this file into a React project with Tailwind configured (Create React App / Vite + Tailwind)
// - No external API required.
// - Saves last input to localStorage and shows sample exercises based on BMI & age.

export default function FitnessGuide() {
  const [age, setAge] = useState(25);
  const [heightCm, setHeightCm] = useState(170);
  const [weightKg, setWeightKg] = useState(65);
  const [result, setResult] = useState(null);
  const [showAdvanced, setShowAdvanced] = useState(false);

  useEffect(() => {
    // load saved values
    try {
      const saved = JSON.parse(localStorage.getItem("fitness_last"));
      if (saved) {
        setAge(saved.age);
        setHeightCm(saved.heightCm);
        setWeightKg(saved.weightKg);
      }
    } catch (e) {
      // ignore
    }
  }, []);

  useEffect(() => {
    // save inputs (debounced could be used but keep simple)
    localStorage.setItem(
      "fitness_last",
      JSON.stringify({ age, heightCm, weightKg })
    );
  }, [age, heightCm, weightKg]);

  function calculate() {
    const h = heightCm / 100;
    if (!h || !weightKg) return;
    const bmi = +(weightKg / (h * h)).toFixed(2);

    let category = "";
    let short = "";
    if (bmi < 18.5) {
      category = "Underweight";
      short = "Gain weight safely: focus on strength training & calorie surplus.";
    } else if (bmi < 25) {
      category = "Normal";
      short = "You're doing well — maintain with mixed cardio + strength.";
    } else if (bmi < 30) {
      category = "Overweight";
      short = "Focus on fat loss: cardio + calorie control + resistance training.";
    } else {
      category = "Obese";
      short = "Medical/structured plan recommended: moderate cardio, strength, and dietary changes.";
    }

    const targetWeightRange = getIdealWeightRange(heightCm);
    const exercises = recommendExercises(bmi, age);
    const nutrition = recommendNutrition(bmi);

    setResult({ bmi, category, short, targetWeightRange, exercises, nutrition });
  }

  function reset() {
    setAge(25);
    setHeightCm(170);
    setWeightKg(65);
    setResult(null);
    localStorage.removeItem("fitness_last");
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-gray-50 to-white flex items-center justify-center p-6">
      <div className="max-w-4xl w-full bg-white shadow-2xl rounded-2xl p-6 md:p-10 grid md:grid-cols-2 gap-6">
        <motion.div
          initial={{ x: -40, opacity: 0 }}
          animate={{ x: 0, opacity: 1 }}
          transition={{ duration: 0.5 }}
          className="flex flex-col gap-4"
        >
          <div>
            <h1 className="text-2xl md:text-3xl font-semibold">Fitness Guide</h1>
            <p className="text-sm text-gray-600 mt-1">Enter age, height and weight — get BMI, personalized exercise & nutrition tips.</p>
          </div>

          <div className="bg-gray-50 p-4 rounded-xl">
            <label className="text-sm text-gray-700">Age</label>
            <input
              type="number"
              min={10}
              max={100}
              value={age}
              onChange={(e) => setAge(Number(e.target.value))}
              className="w-full mt-2 p-3 rounded-md border focus:outline-none focus:ring-2 focus:ring-indigo-200"
            />

            <label className="text-sm text-gray-700 mt-3 block">Height (cm)</label>
            <input
              type="number"
              min={50}
              max={250}
              value={heightCm}
              onChange={(e) => setHeightCm(Number(e.target.value))}
              className="w-full mt-2 p-3 rounded-md border focus:outline-none focus:ring-2 focus:ring-indigo-200"
            />

            <label className="text-sm text-gray-700 mt-3 block">Weight (kg)</label>
            <input
              type="number"
              min={20}
              max={300}
              value={weightKg}
              onChange={(e) => setWeightKg(Number(e.target.value))}
              className="w-full mt-2 p-3 rounded-md border focus:outline-none focus:ring-2 focus:ring-indigo-200"
            />

            <div className="flex gap-3 mt-4">
              <button
                onClick={calculate}
                className="px-4 py-2 bg-indigo-600 text-white rounded-lg shadow hover:bg-indigo-700"
              >
                Calculate
              </button>
              <button
                onClick={reset}
                className="px-4 py-2 border rounded-lg text-gray-700 hover:bg-gray-100"
              >
                Reset
              </button>

              <button
                onClick={() => setShowAdvanced((s) => !s)}
                className="ml-auto text-sm text-indigo-600 underline"
              >
                {showAdvanced ? "Hide" : "Show"} more tips
              </button>
            </div>

            <p className="text-xs text-gray-500 mt-3">Note: This is a general guide. For medical conditions or big weight changes, consult a professional.</p>
          </div>

          <div className="mt-auto text-xs text-gray-600">
            <p>
              Built with ❤️ for your project. TailwindCSS + React. Add images/video later to make it richer.
            </p>
          </div>
        </motion.div>

        <motion.div
          initial={{ x: 40, opacity: 0 }}
          animate={{ x: 0, opacity: 1 }}
          transition={{ duration: 0.5 }}
          className="p-4 bg-gradient-to-b from-white to-gray-50 rounded-2xl"
        >
          <div className="flex flex-col gap-4">
            <ResultCard result={result} />

            {showAdvanced && (
              <div className="mt-4 bg-white border rounded-xl p-4">
                <h3 className="font-medium">Advanced Suggestions</h3>
                <ul className="list-disc list-inside text-sm text-gray-700 mt-2">
                  <li>Track workouts: 3–5 sessions/week (mix cardio + strength).</li>
                  <li>Progressive overload for strength: slowly increase reps/weights.</li>
                  <li>Prioritize sleep (7–9 hours) and hydration.</li>
                  <li>If aiming to lose fat, create a 300–750 kcal/day deficit; for gain, a 250–500 kcal surplus.</li>
                </ul>
              </div>
            )}

            <div className="mt-4">
              <h4 className="text-sm font-medium">Quick Tips</h4>
              <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 mt-2">
                <div className="p-3 bg-white rounded-lg border">Warm-up: 5–10 min light cardio</div>
                <div className="p-3 bg-white rounded-lg border">Cool-down: stretch 5–8 min</div>
                <div className="p-3 bg-white rounded-lg border">Protein: ~1.2–1.6 g/kg for active adults</div>
                <div className="p-3 bg-white rounded-lg border">Consistency over intensity</div>
              </div>
            </div>

            <footer className="text-xs text-gray-500 mt-4">Made for your college project • Add personalization later (DB, auth, images)</footer>
          </div>
        </motion.div>
      </div>
    </div>
  );
}

function ResultCard({ result }) {
  if (!result) {
    return (
      <div className="p-6 border rounded-xl text-center text-gray-500">Enter details and press Calculate to see results.</div>
    );
  }

  return (
    <div className="p-6 bg-white border rounded-2xl shadow-sm">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-lg font-semibold">Your Results</h2>
          <p className="text-sm text-gray-500">BMI, category, and suggestions</p>
        </div>
        <div className="text-right">
          <div className="text-2xl font-bold">{result.bmi}</div>
          <div className="text-xs text-gray-600">BMI</div>
        </div>
      </div>

      <div className="mt-4 grid gap-3">
        <div className="p-3 rounded-lg bg-gray-50">
          <div className="text-sm text-gray-700">Category</div>
          <div className="font-medium">{result.category}</div>
          <div className="text-xs text-gray-500 mt-1">{result.short}</div>
        </div>

        <div className="p-3 rounded-lg bg-white border">
          <div className="text-sm text-gray-700">Target weight range</div>
          <div className="font-medium">{result.targetWeightRange.min} kg — {result.targetWeightRange.max} kg</div>
          <div className="text-xs text-gray-500 mt-1">(Approx. healthy range for your height)</div>
        </div>

        <div className="p-3 rounded-lg bg-white border">
          <div className="text-sm text-gray-700">Recommended exercises</div>
          <div className="mt-2 grid gap-2">
            {result.exercises.map((ex, i) => (
              <div key={i} className="p-2 rounded-md bg-gray-50 text-sm">• {ex}</div>
            ))}
          </div>
        </div>

        <div className="p-3 rounded-lg bg-white border">
          <div className="text-sm text-gray-700">Nutrition basics</div>
          <div className="text-sm mt-1">{result.nutrition}</div>
        </div>
      </div>
    </div>
  );
}

function getIdealWeightRange(heightCm) {
  // returns approximate weight range (kg) for BMI 18.5 - 24.9
  const h = heightCm / 100;
  const min = Math.round(18.5 * h * h);
  const max = Math.round(24.9 * h * h);
  return { min, max };
}

function recommendExercises(bmi, age) {
  // basic heuristic exercised suggestions
  const list = [];
  if (bmi < 18.5) {
    list.push("Full-body strength training 3x/week (compound lifts or bodyweight progressions)");
    list.push("High-calorie nutrient-dense meals post-workout");
    list.push("Mobility work and core strengthening");
  } else if (bmi < 25) {
    list.push("Mix of strength (3x/week) + cardio (2x/week)");
    list.push("HIIT sessions 1–2x/week if fat loss desired");
    list.push("Flexibility: yoga or stretching 2–3x/week");
  } else if (bmi < 30) {
    list.push("Cardio 3–5x/week (30–60 min: brisk walk, cycle, run)");
    list.push("Resistance training 3x/week to preserve muscle");
    list.push("Start with low-impact cardio if joints are an issue");
  } else {
    list.push("Medical clearance recommended before intense exercise");
    list.push("Low-impact cardio (walking, cycling, swimming)");
    list.push("Beginner strength routine 2–3x/week focusing on movement quality");
  }

  // age-based tweak (simple)
  if (age > 45) {
    list.push("Include balance & joint mobility work; consult trainer if new to exercise");
  }

  return list;
}

function recommendNutrition(bmi) {
  if (bmi < 18.5)
    return "Eat regular meals with calorie surplus, focus on proteins + healthy fats + complex carbs. Consider 3–5 meals + snacks.";
  if (bmi < 25)
    return "Balanced diet with adequate protein (~1.2 g/kg), whole grains, fruits & vegetables. Maintain calorie balance. Hydration.";
  if (bmi < 30)
    return "Calorie deficit for fat loss; prioritize protein, reduce sugary/processed foods, prefer whole foods over empty calories.";
  return "Consult a dietitian for a structured plan; focus on gradual calorie reduction and protein to preserve muscle mass.";
}
